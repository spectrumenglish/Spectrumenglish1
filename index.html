<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Spectrum English - Online Courses & Study Materials</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <style>
        /* ... (SAME STYLES AS YOUR CODE; SKIPPED FOR BREVITY) ... */
    </style>
</head>
<body class="min-h-screen">

    <!-- ... (YOUR EXISTING HTML - NAV, HEADER, MAIN, FOOTER, ETC. NO CHANGE) ... -->

    <!-- Footer -->
    <footer class="bg-gray-800 text-white mt-12">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8 text-center">
            <p class="text-sm">&copy; 2024 Spectrum English. All Rights Reserved.</p>
            <p class="text-xs text-gray-400 mt-1">Designed by Web Developer | <span class="text-blue-400">Zaheer Creations</span></p>
        </div>
    </footer>

    <!-- MAIN JAVASCRIPT LOGIC -->
    <script type="module">
        // ========== FIREBASE/Firestore SETUP (MODULE) ==========
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.11.0/firebase-app.js";
        import { getFirestore, collection, getDocs } from "https://www.gstatic.com/firebasejs/10.11.0/firebase-firestore.js";

        // Your Firebase config
        const firebaseConfig = {
            apiKey: "AIzaSyDCWPnWFcRLy3BMxBmi5hl3RfeR8n-Tqa8",
            authDomain: "mywe-cfed3.firebaseapp.com",
            projectId: "mywe-cfed3",
            storageBucket: "mywe-cfed3.firebasestorage.app",
            messagingSenderId: "395232065402",
            appId: "1:395232065402:web:350f8ca9ea5c37c5ad48c3",
            measurementId: "G-B3CG89SX0Y"
        };
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        // ========== INTERSECTION OBERSERVER FOR ANIMATIONS ==========
        let observer;
        const initObserver = () => {
            const observerOptions = { root: null, rootMargin: '0px', threshold: 0.1 };
            observer = new IntersectionObserver((entries, obs) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        const delay = parseInt(entry.target.getAttribute('data-delay')) || 0;
                        setTimeout(() => {
                            entry.target.classList.add('visible');
                        }, delay);
                        obs.unobserve(entry.target);
                    }
                });
            }, observerOptions);
        };

        // ========== FIRESTORE ENABLED: LOAD MATERIALS ==========
        async function loadMaterials() {
            const container = document.getElementById('ebook-grid');
            if (!container) return;

            container.innerHTML = `<p class='text-gray-500 col-span-5 text-center py-10'>Loading materials...</p>`;

            // Fetch from Firestore
            try {
                const querySnapshot = await getDocs(collection(db, "materials"));
                const materials = [];
                querySnapshot.forEach(doc => {
                    materials.push(doc.data());
                });

                container.innerHTML = ''; // Clear loader

                if (!materials.length) {
                    container.innerHTML = `<p class='text-gray-500 col-span-5 text-center py-10'>No material found.</p>`;
                    return;
                }

                materials.forEach((mat, index) => {
                    const delay = (index % 5 + 1) * 150;
                    const html = `
                        <div class="item-card item-card-study bg-white rounded-xl shadow-lg overflow-hidden transition duration-300 hover:shadow-xl text-center" 
                             data-category="${mat.category}" data-delay="${delay}">
                            <img src="${mat.image || 'https://placehold.co/400x300'}" alt="${mat.title}" class="study-material-img">
                            <div class="p-4">
                                <h3 class="text-md font-bold text-gray-800 mb-1">${mat.title}</h3>
                                <p class="text-sm font-semibold text-red-600 mb-3">${mat.category ? mat.category.toUpperCase() : 'PDF'}</p>
                                <a href="${mat.file || '#'}" target="_blank" class="btn-download text-white px-3 py-2 text-xs rounded font-semibold inline-block">
                                    <i class="fas fa-download mr-1"></i> Download PDF
                                </a>
                            </div>
                        </div>
                    `;
                    container.insertAdjacentHTML('beforeend', html);
                });

                // Attach animation observer
                document.querySelectorAll('#ebook-grid .item-card-study').forEach(el => observer.observe(el));

            } catch (error) {
                container.innerHTML = `<p class='text-red-600 col-span-5 text-center py-10'>Error loading materials: ${error.message}</p>`;
            }
        }

        // ========== (Optional) Courses/Tests LOADER: OLD LOCALSTORAGE BASED ==========
        function loadCourses() {
            const courses = JSON.parse(localStorage.getItem('courses')) || [];
            if (courses.length === 0) return;
            const container = document.getElementById('course-grid');
            if (!container) return;
            container.innerHTML = '';
            courses.forEach((course, index) => {
                const delay = (index % 6 + 1) * 100;
                const isFree = course.price === 0 || course.price === "0" || course.category.includes('free');
                const priceDisplay = isFree 
                    ? '<span class="text-2xl font-extrabold text-green-600">FREE</span>' 
                    : `<span class="text-2xl font-extrabold text-red-600">PKR ${course.price}</span>`;
                const btnClass = isFree ? 'btn-download' : 'btn-whatsapp';
                const btnText = isFree ? (course.linkType === 'whatsapp' ? 'Join Group' : 'Download') : 'Join Now';
                let btnLink = '#';
                if (course.file) btnLink = course.file;
                else if (course.link) btnLink = course.link;
                else if (!isFree) btnLink = `https://wa.me/923013858453?text=Interested%20in%20${encodeURIComponent(course.title)}%20Course.`;
                const featuresHtml = course.features ? course.features.map(f => `<li><i class="fas fa-check-circle text-green-500 mr-2"></i> ${f}</li>`).join('') : '';
                const html = `
                    <div class="item-card bg-white rounded-xl shadow-lg overflow-hidden transition duration-300 hover:shadow-xl" 
                         data-category="${course.category}" data-delay="${delay}">
                        <img src="${course.image || 'https://placehold.co/600x150'}" alt="${course.title}" class="course-card-img">
                        <div class="p-6">
                            <span class="inline-block ${isFree ? 'bg-green-100 text-green-800' : 'bg-blue-100 text-blue-800'} text-xs font-semibold px-3 py-1 rounded-full mb-3">
                                ${isFree ? 'FREE' : 'PREMIUM'}
                            </span>
                            <h3 class="text-xl font-bold text-gray-800 mb-2">${course.title}</h3>
                            <p class="text-sm text-gray-500 mb-4">${course.description}</p>
                            <ul class="text-sm text-gray-600 space-y-2 mb-4">${featuresHtml}</ul>
                            <div class="flex justify-between items-center mt-4">
                                ${priceDisplay}
                                <a href="${btnLink}" target="_blank" class="${btnClass} text-white px-4 py-2 text-sm rounded-lg font-semibold">
                                    ${btnText}
                                </a>
                            </div>
                        </div>
                    </div>
                `;
                container.insertAdjacentHTML('beforeend', html);
            });
            document.querySelectorAll('#course-grid .item-card').forEach(el => observer.observe(el));
        }

        // ========== PAGE INIT ==========
        document.addEventListener('DOMContentLoaded', async () => {
            initObserver();
            loadCourses(); // localStorage based, same as before
            await loadMaterials(); // Firestore!
            // (Baaki JS logic, navigation, animations, filters, as per original code)
        });

        // ========== FILTER LOGIC & OTHER JS (COPY FROM ORIGINAL IF NEEDED) ==========
        // ... navigation, category filter, mcq, etc ... (no change)
    </script>
</body>
</html>
